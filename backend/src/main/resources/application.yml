server:
  port: 8080

spring:
  application:
    name: ai-agent-standalone
  
  # 激活的配置文件（可通过环境变量或启动参数指定）
  # 例如：java -jar app.jar --spring.profiles.active=dev
  # 或者：export SPRING_PROFILES_ACTIVE=dev
  # 默认：local（本地开发环境）
  profiles:
    active: ${SPRING_PROFILES_ACTIVE:local}
  
  # 配置文件导入（Spring Boot 2.4+）
  # 根据激活的profile，自动导入对应的配置文件
  # 配置文件位置：profile/{profile}/application.yml
  # 
  # 注意：由于需要在解析spring.profiles.active之后才能知道profile值
  # 这里使用占位符，Spring Boot会自动替换
  # 如果profile配置文件不存在，optional: 前缀会使其静默失败，使用默认配置
  config:
    import:
      - optional:classpath:profile/${spring.profiles.active}/application.yml
  
  # Redis配置（用于存储对话、文档元数据、知识库等）
  # 注意：本项目不使用MySQL，所有数据存储在Redis中
  redis:
    host: ${SPRING_REDIS_HOST:localhost}
    port: ${SPRING_REDIS_PORT:6379}
    password: ${SPRING_REDIS_PASSWORD:}
    database: 0
    timeout: 5000ms
    lettuce:
      pool:
        max-active: 8
        max-idle: 8
        min-idle: 0
  
  # MySQL配置（用于会话和消息持久化）
  datasource:
    type: com.alibaba.druid.pool.DruidDataSource
    driver-class-name: com.mysql.cj.jdbc.Driver
    url: ${SPRING_DATASOURCE_URL:jdbc:mysql://localhost:3306/zeno_agent?useUnicode=true&characterEncoding=utf8&serverTimezone=Asia/Shanghai&useSSL=false}
    username: ${SPRING_DATASOURCE_USERNAME:root}
    password: ${SPRING_DATASOURCE_PASSWORD:jinhaolin}
    druid:
      initial-size: 5
      min-idle: 5
      max-active: 20
      max-wait: 60000
      test-while-idle: true
      test-on-borrow: false
      test-on-return: false

# MyBatis配置
mybatis:
  mapper-locations: classpath:mapper/*.xml
  type-aliases-package: com.aiagent.entity
  configuration:
    map-underscore-to-camel-case: true
    log-impl: org.apache.ibatis.logging.slf4j.Slf4jImpl

# AI Agent 配置
aiagent:
  # LLM配置
  llm:
    # 请求超时（秒）
    timeout-seconds: 180
    # 模型列表配置（支持多个模型，按id引用）
    models:
      - id: gpt-4o-mini
        name: GPT-4o Mini
        provider: OPENAI
        type: CHAT  # 模型类型：CHAT（对话模型）或 EMBEDDING（向量模型）
        apiKey:
        baseUrl: https://api.openai.com/v1
        timeout-seconds: 240
      - id: gpt-4o
        name: GPT-4o
        provider: OPENAI
        type: CHAT
        apiKey:
        baseUrl: https://api.openai.com/v1
      # Embedding 模型配置
      - id: text-embedding-3-small
        name: OpenAI Embedding 3 Small
        provider: OPENAI
        type: EMBEDDING  # 向量模型
        modelName: text-embedding-3-small  # 实际的模型名称（用于Embedding API调用）
        apiKey:
        baseUrl: https://api.openai.com/v1
    # 默认模型ID（从上面的models列表中选择）
    default-model: gpt-4o-mini
  
  # 模型配置
  model:
    default-model-id: gpt-4o-mini
    # 任务模型映射（值为模型ID列表，按顺序尝试，前面的失败会尝试后面的）
    task-model-mapping:
      SIMPLE_CHAT:
        - gpt-4o-mini
      RAG_QUERY:
        - gpt-4o-mini
      TOOL_CALL:
        - gpt-4o
        - gpt-4o-mini
      COMPLEX_WORKFLOW:
        - gpt-4o
        - gpt-4o-mini
  
  memory:
    short-term-expire-hours: 24
    context-expire-hours: 1
    max-context-window: 20
  
  rag:
    # 默认 Embedding 模型ID（从 llm.models 中选择，必须是 type: EMBEDDING 的模型）
    default-embedding-model-id: text-embedding-3-small
    # 向量存储配置（PostgreSQL + pgvector）
    # 注意：RAG功能需要PostgreSQL数据库并安装pgvector扩展
    # 安装pgvector扩展命令：
    #   CREATE EXTENSION vector;
    # 如果不需要RAG功能，可以不配置此项
    embedding-store:
      host: localhost
      port: 5432
      database: zeno_agent
      user: rag_user
      password: Rag@123456
      table: embeddings
      use-index: false  # 禁用索引（2560维向量超过ivfflat索引的2000维限制）
      index-list-size: 100
    # 文档分段配置
    document:
      segment-size: 1000
      overlap-size: 50
    # 文件上传配置
    upload:
      path: ./uploads
      max-file-size: 157286400  # 150MB
      max-zip-size: 1073741824  # 1GB
      max-zip-entries: 10000
  
  tools:
    enabled-by-default: true
  
  # MCP工具配置
  # 注意：MCP服务器配置已迁移到 JSON 文件
  # 
  # 配置文件路径优先级：
  # 1. aiagent.mcp.config-path 指定的路径（如果配置）
  # 2. profile/{profile}/mcp.json（根据当前激活的profile，推荐）
  # 3. mcp.json（默认路径，向后兼容）
  # 
  # 示例：
  # - profile=local: 使用 profile/local/mcp.json
  # - profile=dev: 使用 profile/dev/mcp.json
  # - profile=prod: 使用 profile/prod/mcp.json
  mcp:
    # 是否启用MCP功能
    enabled: true
    # 配置文件路径（可选，不配置则自动根据profile查找）
    # 如果指定，将优先使用此路径，支持绝对路径和相对路径
    # config-path: profile/local/mcp.json
    # 是否启用热加载（默认：true，仅对外部文件有效）
    hot-reload: true

# SpringDoc API 文档
springdoc:
  api-docs:
    path: /api-docs
  swagger-ui:
    path: /swagger-ui.html


